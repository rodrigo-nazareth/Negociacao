/******************************************************************************/
/***               Generated by IBExpert 12/04/2020 17:10:31                ***/
/******************************************************************************/

/******************************************************************************/
/***      Following SET SQL DIALECT is just for the Database Comparer       ***/
/******************************************************************************/
SET SQL DIALECT 3;



/******************************************************************************/
/***                                 Tables                                 ***/
/******************************************************************************/



CREATE TABLE LIMITES_CREDITO_PRODUTOR (
    PRODUTOR_ID                INTEGER NOT NULL,
    DISTRIBUIDOR_ID            INTEGER NOT NULL,
    LIMITE_CREDITO             NUMERIC(12,2) NOT NULL,
    LIMITE_CREDITO_UTILIZADO   NUMERIC(12,2) NOT NULL,
    LIMITE_CREDITO_DISPONIVEL  NUMERIC(12,2) NOT NULL
);




/* Check constraints definition */

ALTER TABLE LIMITES_CREDITO_PRODUTOR ADD CONSTRAINT CK_LIM_CR_PRODUTOR_LIM_CREDITO CHECK (LIMITE_CREDITO >= 0);
ALTER TABLE LIMITES_CREDITO_PRODUTOR ADD CONSTRAINT CK_LIM_CR_PRODUTOR_LIM_CR_UTIL CHECK (LIMITE_CREDITO_UTILIZADO >= 0);
ALTER TABLE LIMITES_CREDITO_PRODUTOR ADD CONSTRAINT CK_LIM_CR_PRODUTOR_LIM_CR_DISP CHECK (LIMITE_CREDITO_DISPONIVEL >= 0);
ALTER TABLE LIMITES_CREDITO_PRODUTOR ADD CONSTRAINT CK_LIM_CR_PRODUTOR_LIMITES CHECK (LIMITE_CREDITO_UTILIZADO + LIMITE_CREDITO_DISPONIVEL <= LIMITE_CREDITO);


/******************************************************************************/
/***                              Primary Keys                              ***/
/******************************************************************************/

ALTER TABLE LIMITES_CREDITO_PRODUTOR ADD CONSTRAINT PK_LIMITES_CREDITO_PRODUTOR PRIMARY KEY (PRODUTOR_ID, DISTRIBUIDOR_ID);


/******************************************************************************/
/***                              Foreign Keys                              ***/
/******************************************************************************/

ALTER TABLE LIMITES_CREDITO_PRODUTOR ADD CONSTRAINT FK_LIM_CRE_PRO_DISTRIBUIDOR_ID FOREIGN KEY (DISTRIBUIDOR_ID) REFERENCES PESSOAS (PESSOA_ID);
ALTER TABLE LIMITES_CREDITO_PRODUTOR ADD CONSTRAINT FK_LIM_CRE_PRO_PRODUTOR_ID FOREIGN KEY (PRODUTOR_ID) REFERENCES PESSOAS (PESSOA_ID);


/******************************************************************************/
/***                                Triggers                                ***/
/******************************************************************************/


SET TERM ^ ;



/******************************************************************************/
/***                          Triggers for tables                           ***/
/******************************************************************************/



/* Trigger: LIMITES_CREDITO_PRODUTOR_BIU0 */
CREATE OR ALTER TRIGGER LIMITES_CREDITO_PRODUTOR_BIU0 FOR LIMITES_CREDITO_PRODUTOR
ACTIVE BEFORE INSERT OR UPDATE POSITION 0
AS
begin
  /* Trigger text */
  new.LIMITE_CREDITO_DISPONIVEL = new.LIMITE_CREDITO - new.LIMITE_CREDITO_UTILIZADO;
end
^


SET TERM ; ^



/******************************************************************************/
/***                               Privileges                               ***/
/******************************************************************************/
